library(tidyverse)
library(tidylog)
library(magrittr)
library(janitor)
install.packages("haven")
library(here)
here()
here("Original Data")
here("Original Data/2000")
dir(here("Original Data/2000"))
?here
?read.delim
pisa_2000_math = read.delim(here("Original Data","2000","intstud_math_v3.txt"),sep = "\t")
pisa_2000_math = read.delim(here("Original Data","2000","intstud_math_v3.txt"),sep = "\s")
pisa_2000_math = read.delim(here("Original Data","2000","intstud_math_v3.txt"),sep = "\\s")
pisa_2000_math = read.delim(here("Original Data","2000","intstud_math_v3.txt"),sep = " ")
pisa_2000_math = read.table(here("Original Data","2000","intstud_math_v3.txt"),sep = "")
widths_2000_math = read.table(here("Original Data","2000","widths_math.txt"),sep = "")
View(widths_2000_math)
widths_2000_math = read.table(here("Original Data","2000","widths_math.txt"),sep = "",header = TRUE)
View(pisa_2000_math)
pisa_2000_math[1]
pisa_2000_math[1,]
pisa_2000_math = read.table(here("Original Data","2000","intstud_math_v3.txt"),sep = "",header = FALSE)
pisa_2000_math = read.table(here("Original Data","2000","intstud_math_v3.txt"),sep = ";",header = FALSE)
zz_test = pisa_2000_math %>% filter(row_number() <= 1000) %>% mutate(trimvar = V1 %>% str_remove_all("\\s"))
View(zz_test)
zz_test %>% mutate(var_len = str_length(trimvar)) %>% View
zz_test %>% mutate(var_len = V1 %>% str_trim %>% str_length) %>% View
zz_test %>% mutate(var_len = V1 %>% str_trim %>% str_length) %>% summary
widths_2000_math %>% summarize(sum(width))
widths_2000_math %>% summarize(width %>% sum)
rm(list = ls())
gc()
?rename_with
library(tidyverse)
?rename_with
testdata = data.frame(`1` = runif(5),`2` = runif(5)) %>% mutate(`Modeled means` = "abc","Group" = "x") %>% relocate(Group)
testdata
library(magrittr)
testdata %>% rename(X1 = `1`)
testdata %>% rename(`1` = X1)
testdata %>% rename(`2` = X2)
testdata %>% select(where(is.numeric))
testdata
testdata %<>% rename(`1` = X1)
testdata %<>% rename(`2` = X2)
testdata
testdata %>% select(num_range("",`:2`))
testdata %>% select(num_range("",1:2`))
testdata %>% select(num_range("",1:2))
?rename_with
names = c("a1","a2")
testdata %>% rename_with(.fn = ~names,.cols = num_range("",1:2))
testdata %<>% mutate(NA = runif(5)) %>% relocate(NA,.after = a2)
testdata %<>% mutate(NA = runif(5)) %>% relocate(NA,.after( `2`))
testdata %<>% mutate(NA = runif(5))
testdata %<>% mutate(`NA` = runif(5))
testdata
testdata %<>% relocate("NA",.after(`2`))
testdata %<>% relocate("NA",.after=`2`)
testdata
testdata %>% rename_with(.fn = ~names,.cols = num_range("",1:2))
testdata %>% rename_with(.fn = ~names,.cols = num_range("",1:5))
testdata %>% rename_with(.fn = ~names,.cols = num_range("",1:10))
testdata %>% names
(testdata %>% names)[where(str_length(testdata %>% names) == 1)]
(testdata %>% names)[(str_length(testdata %>% names) == 1)]
(testdata %>% names)[(str_length(testdata %>% names) %in% c(1:10)]
(testdata %>% names)[(str_length(testdata %>% names) %in% as.character(c(1:10))]
(str_length(testdata %>% names) %in% as.character(c(1:10))
(str_length(testdata %>% names) %in% as.character(c(1:10)))
(testdata %>% names %in% as.character(c(1:10)))
(testdata %>% names)[(testdata %>% names %in% as.character(c(1:10)))]
?haven
library(tidyverse)
library(tidylog)
library(magrittr)
library(janitor)
library(here)
?haven
pisa_2000_sch = read_sav(here("Original Data","2000","intscho.sav"))
pisa_2000_sch = read_spss(here("Original Data","2000","intscho.sav"))
haven::read_sav
library(tidyverse)
read_sav
library(haven)
pisa_2000_sch = read_spss(here("Original Data","2000","intscho.sav"))
View(pisa_2000_sch)
pisa_2000_sch %>% names
pisa_2000_sch %>% labels
pisa_2000_sch = read_spss(here("Original Data","2000","intscho.sav"))
pisa_2000_math = read_spss(here("Original Data","2000","intstud_math.sav"))
pisa_2000_read = read_spss(here("Original Data","2000","intstud_read.sav"))
pisa_2000_scie = read_spss(here("Original Data","2000","intstud_scie.sav"))
pisa_2003_sch = read_spss(here("Original Data","2003","INT_schi_2003.sav"))
pisa_2003_std = read_spss(here("Original Data","2003","INT_stui_2003.sav"))
pisa_2006_sch = read_spss(here("Original Data","2003","INT_Sch06_Dec07.sav"))
pisa_2006_std = read_spss(here("Original Data","2003","INT_Stu06_Dec07.sav"))
pisa_2006_sch = read_spss(here("Original Data","2006","INT_Sch06_Dec07.sav"))
pisa_2006_std = read_spss(here("Original Data","2006","INT_Stu06_Dec07.sav"))
pisa_2009_sch = read_spss(here("Original Data","2009","INT_SCQ09.sav"))
pisa_2009_std = read_spss(here("Original Data","2009","INT_STQ09.sav"))
pisa_2012_sch = read_spss(here("Original Data","2012","INT_SCQ12.sav"))
pisa_2012_std = read_spss(here("Original Data","2012","INT_STU12.sav"))
pisa_2000_math %>% names
pisa_2000_read %>% names
View(pisa_2000_math)
View(pisa_2000_read)
pisa_2000_read %>% select(STIDSTD,contains("read")) %>% names
pisa_2000_math %>% select(contains("read")) %>% names
pisa_2000_read %>% select(STIDSTD,matches("pv*read")) %>% names
pisa_2000_read %>% select(STIDSTD,matches("pv.read")) %>% names
pisa_2000_math %>% select(STIDSTD,matches("pv.read")) %>% names
pisa_2000_scie %>% names
pisa_2000_math %>% names
pisa_2000_math %>% select(STIDSTD,matches("pv.math")) %>% names
pisa_2000_read %>% select(STIDSTD,matches("pv.math")) %>% names
pisa_2000 = pisa_2000_read %>%
full_join(pisa_2000_math %>%
select(STIDSTD,matches("pv.math")) %>%
mutate(data_source = "MATH"),
by = c("STIDSTD"))
rm(pisa_2000_scie)
zz_test = pisa_2000_read %>%
select(STIDSTD) %>%
mutate(data_source = "READ") %>%
full_join(pisa_2000_math %>%
select(STIDSTD) %>%
mutate(data_source = "MATH"),by = "STIDSTD")
pisa_2000_read %>% count(STIDSTD) %>% count(n)
pisa_2000_read %>% count(SCHOOLID,STIDSTD) %>% count(n)
pisa_2000_read %>% count(COUNTRY,SCHOOLID,STIDSTD) %>% count(n)
pisa_2000 = pisa_2000_read %>%
mutate(data_source = "READ") %>%
full_join(pisa_2000_math %>%
select(COUNTRY,SCHOOLID,STIDSTD,matches("pv.math")) %>%
mutate(data_source = "MATH"),
by = c("COUNTRY","SCHOOLID","STIDSTD"))
pisa_2000 %>% count(data_source)
pisa_2000 %>% names
pisa_2000 = pisa_2000_read %>%
mutate(data_source = "READ") %>%
full_join(pisa_2000_math %>%
select(COUNTRY,SCHOOLID,STIDSTD,matches("pv.math")) %>%
mutate(data_source_m = "MATH"),
by = c("COUNTRY","SCHOOLID","STIDSTD")) %>%
mutate(data_source = case_when(is.na(data_source) ~ data_source_m,
TRUE ~ data_source)) %>%
select(-data_source_m)
pisa_2000 = pisa_2000_read %>%
mutate(indata_read = 1) %>%
full_join(pisa_2000_math %>%
select(COUNTRY,SCHOOLID,STIDSTD,matches("pv.math")) %>%
mutate(indata_math = 1),
by = c("COUNTRY","SCHOOLID","STIDSTD")) %>%
mutate(indata_read = case_when(is.na(indata_read) ~ 0,
TRUE ~ indata_read),
indata_math = case_when(is.na(indata_math) ~ 0,
TRUE ~ indata_math))
pisa_2000 %>% count(indata_read,indata_math)
pisa_2000_sch %>% count(schoolid) %>% count(n)
pisa_2000_sch %>% count(country,schoolid) %>% count(n)
pisa_2000_sch
pisa_2000_sch %>% names
setdiff(pisa_2000 %>% names,pisa_2000_sch %>% names)
?union
intersect(pisa_2000 %>% names,pisa_2000_sch %>% names)
intersect(pisa_2000 %>% names %>% str_to_lower,pisa_2000_sch %>% names)
pisa_2000 %>% clean_names %>% names
pisa_2000 = pisa_2000_read %>%
mutate(indata_read = 1) %>%
full_join(pisa_2000_math %>%
select(COUNTRY,SCHOOLID,STIDSTD,matches("pv.math")) %>%
mutate(indata_math = 1),
by = c("COUNTRY","SCHOOLID","STIDSTD")) %>%
mutate(indata_read = case_when(is.na(indata_read) ~ 0,
TRUE ~ indata_read),
indata_math = case_when(is.na(indata_math) ~ 0,
TRUE ~ indata_math)) %>%
left_join(pisa_2000_sch %>%
select(COUNTRY = country,
SCHOOLID = schoolid) ,
by = c("COUNTRY","SCHOOLID")) %>%
clean_names
intersect(pisa_2000 %>% names %>% str_to_lower,pisa_2000_sch %>% names)
pisa_2000 = pisa_2000_read %>%
mutate(indata_read = 1) %>%
full_join(pisa_2000_math %>%
select(COUNTRY,SCHOOLID,STIDSTD,matches("pv.math")) %>%
mutate(indata_math = 1),
by = c("COUNTRY","SCHOOLID","STIDSTD")) %>%
mutate(indata_read = case_when(is.na(indata_read) ~ 0,
TRUE ~ indata_read),
indata_math = case_when(is.na(indata_math) ~ 0,
TRUE ~ indata_math)) %>%
left_join(pisa_2000_sch %>%
rename(COUNTRY = country,
SCHOOLID = schoolid) %>%
select(-c(subnatio,cnt)),
by = c("COUNTRY","SCHOOLID")) %>%
clean_names
pisa_2000 %>% names
saveRDS(pisa_2000,
here("Indata","PISA_raw","PISA_2000.RDS"))
rm(pisa_2000_sch,pisa_2000_math,pisa_2000_read)
rm(zz_test)
intersect(pisa_2003_std %>% names,pisa_2003_sch %>% names)
pisa_2003_sch %>% count(STRATUM)
pisa_2003 = pisa_2003_std %>%
left_join(pisa_2003_sch %>%
select(-c(SUBNATIO,CNT)),
by = c("COUNTRY","SCHOOLID")) %>%
clean_names
saveRDS(pisa_2003,
here("Indata","PISA_raw","PISA_2003.RDS"))
intersect(pisa_2006_std %>% names,pisa_2006_sch %>% names)
pisa_2003 %>% names
pisa_2003 = pisa_2003_std %>%
left_join(pisa_2003_sch %>%
select(-c(SUBNATIO,CNT,STRATUM)),
by = c("COUNTRY","SCHOOLID")) %>%
clean_names
pisa_2006 = pisa_2006_std %>%
left_join(pisa_2006_sch %>%
select(-c(SUBNATIO,CNT,OECD,STRATUM)),
by = c("COUNTRY","SCHOOLID")) %>%
clean_names
pisa_2006 %>% names
saveRDS(pisa_2003,
here("Indata","PISA_raw","PISA_2003.RDS"))
## 2006
saveRDS(pisa_2006,
here("Indata","PISA_raw","PISA_2006.RDS"))
intersect(pisa_2009_std %>% names,pisa_2009_sch %>% names)
pisa_2009 = pisa_2009_std %>%
left_join(pisa_2009_sch %>%
select(-c(SUBNATIO,CNT,OECD,STRATUM)),
by = c("COUNTRY","SCHOOLID")) %>%
clean_names
pisa_2009 %>% names
intersect(pisa_2012_std %>% names,pisa_2012_sch %>% names)
saveRDS(pisa_2009,
here("Indata","PISA_raw","PISA_2009.RDS"))
rm(pisa_2003_sch,pisa_2003_std)
rm(pisa_2006_sch,pisa_2006_std)
rm(pisa_2009_sch,pisa_2009_std)
pisa_2012_std %>% count(NC)
pisa_2012 = pisa_2012_std %>%
rename(COUNTRY = NC) %>%
left_join(pisa_2012_sch %>%
rename(COUNTRY = NC) %>%
select(-c(SUBNATIO,OECD,STRATUM,CNT)),
by = c("COUNTRY","SCHOOLID")) %>%
clean_names
saveRDS(pisa_2015,
here("Indata","PISA_raw","PISA_2015.RDS"))
saveRDS(pisa_2012,
here("Indata","PISA_raw","PISA_2012.RDS"))
rm(pisa_2012_sch,pisa_2012_std)
gc()
## 2015
pisa_2015_sch = read_spss(here("Original Data","2015","CY6_MS_CMB_SCH_QQQ.sav"))
pisa_2015_std = read_spss(here("Original Data","2015","CY6_MS_CMB_STU_QQQ.sav"))
## 2018
pisa_2018_sch = read_spss(here("Original Data","2018","SCH","CY07_MSU_SCH_QQQ.sav"))
pisa_2018_std = read_spss(here("Original Data","2018","STD","CY07_MSU_STU_QQQ.sav"))
pisa_2018_std = read_spss(here("Original Data","2018","STU","CY07_MSU_STU_QQQ.sav"))
intersect(pisa_2015_std %>% names,pisa_2015_sch %>% names)
pisa_2015_sch %>% count(CNTSCHID) %>% count(n)
View(pisa_2015_sch)
pisa_2015 = pisa_2015_std %>%
rename(SCHOOLID = CNTSCHID) %>%
left_join(pisa_2015_sch %>%
rename(SCHOOLID = CNTSCHID) %>%
select(-c(CNTRYID,CNT,CYC,NatCen,Region,STRATUM,SUBNATIO,OECD,ADMINMODE,SENWT,VER_DAT)),
by = c("SCHOOLID")) %>%
clean_names
rm(pisa_2018_sch)
rm(pisa_2018_std)
rm(pisa_2000)
rm(pisa_2003)
rm(pisa_2006)
rm(pisa_2009'')
rm(pisa_2009)
gc()
pisa_2015 = pisa_2015_std %>%
rename(SCHOOLID = CNTSCHID) %>%
left_join(pisa_2015_sch %>%
rename(SCHOOLID = CNTSCHID) %>%
select(-c(CNTRYID,CNT,CYC,NatCen,Region,STRATUM,SUBNATIO,OECD,ADMINMODE,SENWT,VER_DAT)),
by = c("SCHOOLID")) %>%
clean_names
rm(pisa_2015_sch,pisa_2015_std)
saveRDS(pisa_2015,
here("Indata","PISA_raw","PISA_2015.RDS"))
gc()
pisa_2018_sch = read_spss(here("Original Data","2018","SCH","CY07_MSU_SCH_QQQ.sav"))
pisa_2018_std = read_spss(here("Original Data","2018","STU","CY07_MSU_STU_QQQ.sav"))
rm(pisa_2012)
rm(pisa_2015)
intersect(pisa_2018_std %>% names,pisa_2018_sch %>% names)
pisa_2018_sch %>% count(CNTSCHID) %>% count(n)
gc()
gc()
pisa_2018 = pisa_2018_std %>%
rename(SCHOOLID = CNTSCHID) %>%
left_join(pisa_2018_sch %>%
rename(SCHOOLID = CNTSCHID) %>%
select(-c(CNTRYID,CNT,CYC,NatCen,STRATUM,SUBNATIO,OECD,ADMINMODE,BOOKID,SENWT,VER_DAT)),
by = c("SCHOOLID")) %>%
clean_names
rm(pisa_2018_sch,pisa_2018_std)
gc()
saveRDS(pisa_2018,
here("Indata","PISA_raw","PISA_2018.RDS"))
rm(list = ls())
gc()
pisa_years = seq(2000,2018,by = 3)
pisa_years
as.list(pisa_years)
pisa_2000 = readRDS(here("InData","PISA_raw","PISA_2000.RDS"))
pisa_2003 = readRDS(here("InData","PISA_raw","PISA_2003.RDS"))
pisa_2000 %>% names %>% sort
pisa_2003 %>% names %>% sort
pisa_2000 %>% count(country)
pisa_2003 %>% count(country)
rm(list = ls())
